<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>–î–Ω–µ–≤–Ω–∏–∫ –ü–∏—Ç–∞–Ω–∏—è</title>
    <style>
        :root {
            --primary-color: #00b894; /* –ë–∏—Ä—é–∑–æ–≤—ã–π, –∫–∞–∫ –Ω–∞ —Å–∫—Ä–∏–Ω—à–æ—Ç–µ */
            --background-color: #f7f8fa;
            --card-color: #ffffff;
            --text-color: #2d3436;
            --secondary-text-color: #636e72;
            --icon-bg-color: #e8f8f5; /* –°–≤–µ—Ç–ª—ã–π —Ñ–æ–Ω –¥–ª—è –∏–∫–æ–Ω–æ–∫ */
            --water-color: #0984e3;
            --water-bg-color: #eaf5fc;
        }
        
        html, body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--background-color);
            color: var(--text-color);
            -webkit-tap-highlight-color: transparent;
        }

        .page { display: none; padding-bottom: 90px; }
        .page.active { display: block; }
        
        /* --- –ù–∏–∂–Ω—è—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è --- */
        .bottom-nav {
            position: fixed;
            bottom: 0; left: 0; right: 0;
            display: flex;
            background-color: var(--card-color);
            box-shadow: 0 -2px 10px rgba(0,0,0,0.08);
            padding: 10px 0;
            padding-bottom: env(safe-area-inset-bottom);
            z-index: 1000;
        }
        .nav-item { flex: 1; text-align: center; color: var(--secondary-text-color); cursor: pointer; }
        .nav-item.active { color: var(--primary-color); }
        .nav-item svg { width: 24px; height: 24px; margin-bottom: 2px; }
        .nav-item div { font-size: 0.7em; }

        /* --- –°—Ç—Ä–∞–Ω–∏—Ü–∞ "–î–Ω–µ–≤–Ω–∏–∫" --- */
        .header { background: var(--card-color); padding: 15px; padding-top: env(safe-area-inset-top); }
        .calendar-strip { display: flex; justify-content: space-around; align-items: center; margin-bottom: 15px; }
        .calendar-strip .day { text-align: center; padding: 8px; border-radius: 12px; cursor: pointer; width: 38px; }
        .calendar-strip .day.active { background-color: var(--primary-color); color: white; }
        .calendar-strip .day-name { font-size: 0.8em; }
        .calendar-strip .day.active .day-name { color: rgba(255,255,255,0.8); }

        .tracker-card {
            display: flex;
            align-items: center;
            background: var(--card-color);
            padding: 15px;
            border-radius: 16px;
            margin: 12px 15px;
            box-shadow: 0 4px 15px rgba(100,100,100,0.06);
        }
        .tracker-card .icon {
            min-width: 40px; height: 40px;
            border-radius: 12px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5em;
            margin-right: 15px;
            background-color: var(--icon-bg-color);
        }
        .tracker-card .details { flex-grow: 1; }
        .tracker-card .details p { margin: 0; font-weight: 500; }
        .tracker-card .details span { font-size: 0.85em; color: var(--secondary-text-color); }
        .tracker-card .action-btn {
            width: 38px; height: 38px;
            border-radius: 50%;
            background-color: var(--icon-bg-color);
            color: var(--primary-color);
            font-size: 1.8em;
            border: none;
            cursor: pointer;
            line-height: 38px;
        }
        
        .water-card .icon { background-color: var(--water-bg-color); }
        .water-card .action-btn { background-color: var(--water-bg-color); color: var(--water-color); }
        .water-card .details { text-align: center; }
        
        /* --- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ --- */
        .modal {
            display: none;
            position: fixed;
            z-index: 1001;
            left: 0; top: 0;
            width: 100%; height: 100%;
            background-color: var(--background-color);
            flex-direction: column;
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn { from { transform: translateY(100%); } to { transform: translateY(0); } }
        
        .modal-header { display: flex; justify-content: space-between; align-items: center; padding: 15px; }
        .modal-header .close-btn { font-size: 2em; cursor: pointer; border: none; background: none; }
        
        .modal-content { padding: 0 15px; overflow-y: auto; flex-grow: 1; }
        input, select {
            width: 100%;
            padding: 14px;
            margin-bottom: 10px;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1em;
            box-sizing: border-box;
            background: #fff;
        }
        .file-upload-wrapper {
            position: relative; overflow: hidden; display: inline-block;
            width: 100%; padding: 14px; margin-bottom: 10px; border-radius: 10px;
            background: var(--primary-color); color: white; text-align: center; cursor: pointer;
        }
        .file-upload-wrapper input[type=file] {
            font-size: 100px; position: absolute; left: 0; top: 0; opacity: 0; cursor: pointer;
        }
        button.primary {
            background-color: var(--primary-color); color: white; padding: 15px;
            border: none; border-radius: 12px; cursor: pointer; width: 100%;
            font-size: 1.1em; font-weight: 600;
        }
        #search-results button { background-color: #f0f0f0; color: #333; margin-bottom: 5px; text-align: left; }

    </style>
</head>
<body>

    <!-- PAGE 1: –î–Ω–µ–≤–Ω–∏–∫ -->
    <div id="diaryPage" class="page active">
        <div class="header">
            <div class="calendar-strip" id="calendar-strip"></div>
        </div>
        <div id="diary-content"></div>
    </div>

    <!-- PAGE 2: –ë–æ–ª—å—à–µ/–ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
    <div id="settingsPage" class="page">
        <div style="padding: 15px;">
            <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
            <div class="tracker-card">
                <div class="details">
                    <p>–¶–µ–ª–∏</p>
                    <input type="number" id="goal-calories-input" placeholder="–¶–µ–ª—å –∫–∞–ª–æ—Ä–∏–π (–∫–∫–∞–ª)">
                    <input type="number" id="goal-water-input" placeholder="–¶–µ–ª—å –≤–æ–¥—ã (–º–ª)">
                </div>
            </div>
            <div class="tracker-card">
                 <div class="details">
                    <p>API Edamam (–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é)</p>
                    <input type="text" id="edamam-id-input" placeholder="Edamam Application ID">
                    <input type="text" id="edamam-key-input" placeholder="Edamam Application Key">
                </div>
            </div>
            <div class="tracker-card">
                 <div class="details">
                    <p>API (–†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –ø–æ —Ñ–æ—Ç–æ)</p>
                    <input type="text" id="food-api-url-input" placeholder="URL –¥–ª—è API —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è">
                    <input type="text" id="food-api-key-input" placeholder="API –∫–ª—é—á –¥–ª—è —Ñ–æ—Ç–æ">
                </div>
            </div>
            <button class="primary" onclick="saveSettings()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>
    </div>
    
    <!-- –ù–∏–∂–Ω—è—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è -->
    <div class="bottom-nav">
        <div class="nav-item active" onclick="showPage('diaryPage')">
             <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
            <div>–î–Ω–µ–≤–Ω–∏–∫</div>
        </div>
        <div class="nav-item" onclick="showPage('settingsPage')">
            <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24"><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
            <div>–ë–æ–ª—å—à–µ</div>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ -->
    <div id="addFoodModal" class="modal">
        <div class="modal-header">
            <h2 id="modal-title"></h2>
            <button class="close-btn" onclick="closeModal()">&times;</button>
        </div>
        <div class="modal-content">
            <div class="file-upload-wrapper">
                <span>üì∑ –†–∞—Å–ø–æ–∑–Ω–∞—Ç—å –µ–¥—É –ø–æ —Ñ–æ—Ç–æ</span>
                <input type="file" id="photo-upload" accept="image/*" onchange="recognizeFoodByImage(this)">
            </div>
            <p style="text-align:center; color: var(--secondary-text-color); margin: 15px;">- –∏–ª–∏ -</p>
            <input type="search" id="search-food-input" placeholder="–ü–æ–∏—Å–∫ –ø—Ä–æ–¥—É–∫—Ç–∞ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é...">
            <button class="primary" onclick="searchFoodByText()">–ù–∞–π—Ç–∏</button>
            <div id="search-results" style="margin: 15px 0;"></div>
            <hr>
            <input type="text" id="manual-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ">
            <input type="number" id="manual-calories" placeholder="–ö–∞–ª–æ—Ä–∏–∏">
            <input type="number" id="manual-protein" placeholder="–ë–µ–ª–∫–∏ (–≥)">
            <input type="number" id="manual-fat" placeholder="–ñ–∏—Ä—ã (–≥)">
            <input type="number" id="manual-carbs" placeholder="–£–≥–ª–µ–≤–æ–¥—ã (–≥)">
            <button class="primary" onclick="addFoodEntry()">–î–æ–±–∞–≤–∏—Ç—å</button>
        </div>
    </div>
    
    <script>
        let currentMealType = '';
        let selectedDate = new Date();

        // --- –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ ---
        document.addEventListener('DOMContentLoaded', () => {
            loadSettings();
            renderCalendarStrip();
            renderDiary();
            showPage('diaryPage');
        });

        // --- –ù–∞–≤–∏–≥–∞—Ü–∏—è ---
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            const activeNavItem = Array.from(document.querySelectorAll('.nav-item')).find(el => el.getAttribute('onclick') === `showPage('${pageId}')`);
            if(activeNavItem) activeNavItem.classList.add('active');
        }

        function changeDate(days) {
            selectedDate.setDate(selectedDate.getDate() + days);
            renderCalendarStrip();
            renderDiary();
        }

        // --- –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ (–û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞) ---
        function renderCalendarStrip() {
            const strip = document.getElementById('calendar-strip');
            strip.innerHTML = '';
            const today = new Date();
            const dayNames = ['–í—Å', '–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±'];
            
            for (let i = -3; i <= 3; i++) {
                const date = new Date(selectedDate);
                date.setDate(date.getDate() + i);
                const dayDiv = document.createElement('div');
                dayDiv.className = 'day';
                if (date.toDateString() === selectedDate.toDateString()) {
                    dayDiv.classList.add('active');
                }
                dayDiv.innerHTML = `<div class="day-name">${dayNames[date.getDay()]}</div><div class="day-number">${date.getDate()}</div>`;
                dayDiv.onclick = () => {
                    selectedDate = date;
                    renderCalendarStrip();
                    renderDiary();
                };
                strip.appendChild(dayDiv);
            }
        }

        function renderDiary() {
            const dateKey = selectedDate.toISOString().split('T')[0];
            const data = loadDataForDate(dateKey);
            const settings = loadSettings();
            
            const content = document.getElementById('diary-content');
            content.innerHTML = `
                ${createWaterCard(data.water || 0, settings.goalWater || 2000)}
                ${createMealCard('breakfast', '–ó–∞–≤—Ç—Ä–∞–∫', 'üçû', data.food || [])}
                ${createMealCard('lunch', '–û–±–µ–¥', 'üç≤', data.food || [])}
                ${createMealCard('dinner', '–£–∂–∏–Ω', 'üåô', data.food || [])}
                ${createMealCard('snacks', '–ü–µ—Ä–µ–∫—É—Å', 'üçè', data.food || [])}
                ${createSimpleCard('weight', '–í–µ—Å', '‚öñÔ∏è', (data.weight ? `${data.weight} –∫–≥` : '–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π'), 'addWeight()')}
                ${createSimpleCard('activity', '–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å', 'üî•', (data.activity ? `${data.activity} –∫–∫–∞–ª` : '–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π'), 'addActivity()')}
            `;
        }
        
        function createWaterCard(current, goal) {
            return `
            <div class="tracker-card water-card">
                <button class="action-btn" onclick="updateWater(-250)">-</button>
                <div class="details">
                    <div class="icon">üíß</div>
                    <p>${current} / ${goal} –º–ª</p>
                    <span>–í–æ–¥–∞</span>
                </div>
                <button class="action-btn" onclick="updateWater(250)">+</button>
            </div>`;
        }

        function createMealCard(type, name, icon, foodList) {
            const mealItems = foodList.filter(f => f.mealType === type);
            const totalCalories = mealItems.reduce((sum, item) => sum + item.calories, 0);
            let foodHtml = mealItems.map(item => `<div onclick="removeFood('${item.id}')">${item.name} - ${item.calories.toFixed(0)} –∫–∫–∞–ª</div>`).join('');
            
            return `
            <div class="tracker-card">
                <div class="icon">${icon}</div>
                <div class="details">
                    <p>${name}</p>
                    <span id="${type}-details">${totalCalories.toFixed(0)} –∫–∫–∞–ª</span>
                    <div style="font-size: 0.8em; margin-top: 5px;">${foodHtml}</div>
                </div>
                <button class="action-btn" onclick="openModal('${type}', '${name}')">+</button>
            </div>`;
        }
        
        function createSimpleCard(type, name, icon, value, action) {
            return `
            <div class="tracker-card">
                <div class="icon">${icon}</div>
                <div class="details"><p>${name}</p><span>${value}</span></div>
                <button class="action-btn" onclick="${action}">+</button>
            </div>`;
        }

        // --- –†–∞–±–æ—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏ (localStorage) ---
        function loadDataForDate(dateKey) {
            return JSON.parse(localStorage.getItem(dateKey) || '{}');
        }

        function saveDataForDate(dateKey, data) {
            localStorage.setItem(dateKey, JSON.stringify(data));
        }

        function saveSettings() {
            const settings = {
                goalCalories: document.getElementById('goal-calories-input').value,
                goalWater: document.getElementById('goal-water-input').value,
                edamamId: document.getElementById('edamam-id-input').value,
                edamamKey: document.getElementById('edamam-key-input').value,
                foodApiUrl: document.getElementById('food-api-url-input').value,
                foodApiKey: document.getElementById('food-api-key-input').value
            };
            localStorage.setItem('userSettings', JSON.stringify(settings));
            alert('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
            renderDiary();
            showPage('diaryPage');
        }

        function loadSettings() {
            const settings = JSON.parse(localStorage.getItem('userSettings') || '{}');
            document.getElementById('goal-calories-input').value = settings.goalCalories || 2000;
            document.getElementById('goal-water-input').value = settings.goalWater || 2000;
            document.getElementById('edamam-id-input').value = settings.edamamId || '';
            document.getElementById('edamam-key-input').value = settings.edamamKey || '';
            document.getElementById('food-api-url-input').value = settings.foodApiUrl || '';
            document.getElementById('food-api-key-input').value = settings.foodApiKey || '';
            return settings;
        }

        // --- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏ API ---
        function openModal(type, name) {
            currentMealType = type;
            document.getElementById('modal-title').textContent = `–î–æ–±–∞–≤–∏—Ç—å –≤ "${name}"`;
            document.getElementById('addFoodModal').style.display = 'flex';
        }

        function closeModal() { document.getElementById('addFoodModal').style.display = 'none'; }
        
        async function searchFoodByText() {
            const query = document.getElementById('search-food-input').value;
            const settings = loadSettings();
            if (!settings.edamamId || !settings.edamamKey) { alert('–í–≤–µ–¥–∏—Ç–µ API –∫–ª—é—á–∏ Edamam –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö'); return; }
            
            const resultsDiv = document.getElementById('search-results');
            resultsDiv.innerHTML = '–ü–æ–∏—Å–∫...';
            const url = `https://api.edamam.com/api/food-database/v2/parser?app_id=${settings.edamamId}&app_key=${settings.edamamKey}&ingr=${encodeURIComponent(query)}&nutrition-type=logging`;

            try {
                const response = await fetch(url);
                const data = await response.json();
                resultsDiv.innerHTML = '';
                data.hints.slice(0, 5).forEach(item => {
                    const food = item.food;
                    const nutrients = food.nutrients;
                    const foodData = {
                        name: food.label,
                        calories: nutrients.ENERC_KCAL || 0,
                        protein: nutrients.PROCNT || 0,
                        fat: nutrients.FAT || 0,
                        carbs: nutrients.CHOCDF || 0
                    };
                    resultsDiv.innerHTML += `<button class="primary" onclick='selectFood(${JSON.stringify(foodData)})'>${food.label} (${(nutrients.ENERC_KCAL || 0).toFixed(0)} –∫–∫–∞–ª)</button>`;
                });
            } catch (error) { resultsDiv.innerHTML = '–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞.'; }
        }
        
a// –ù–ê–ß–ê–õ–û –ù–û–í–û–ì–û –ë–õ–û–ö–ê
async function recognizeFoodByImage(input) {
    const settings = loadSettings();
    if (!settings.foodApiUrl || !settings.foodApiKey) {
        alert('URL –∏ API –∫–ª—é—á –¥–ª—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –ø–æ —Ñ–æ—Ç–æ –Ω–µ —É–∫–∞–∑–∞–Ω—ã –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö.');
        return;
    }
    if (!input.files[0]) return;

    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∞–¥—Ä–µ—Å –Ω–∞–¥–µ–∂–Ω–æ–≥–æ –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä—è–º–æ –≤ –∫–æ–¥–µ
    const proxyUrl = 'https://cors-anywhere.herokuapp.com/';
    const targetUrl = settings.foodApiUrl;
    
    document.getElementById('search-results').innerHTML = '–ê–Ω–∞–ª–∏–∑ —Ñ–æ—Ç–æ...';
    const formData = new FormData();
    formData.append('file', input.files[0]);

    try {
        // –¢–µ–ø–µ—Ä—å –º—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å—Ç—Ä–æ–∏–º –ø–æ–ª–Ω—ã–π URL: –ü–†–û–ö–°–ò + –ê–î–†–ï–°_API + –ö–õ–Æ–ß_API
        const response = await fetch(`${proxyUrl}${targetUrl}?apiKey=${settings.foodApiKey}`, {
            method: 'POST',
            body: formData
        });

        if (!response.ok) {
           const errorData = await response.json(); // –ü—ã—Ç–∞–µ–º—Å—è –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Ç–µ–∫—Å—Ç –æ—à–∏–±–∫–∏ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
           throw new Error(`–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${response.status}. ${errorData.message || ''}`);
        }

        const data = await response.json();
        
        if (data.category && data.nutrition && data.nutrition.calories) {
            const foodData = {
                name: data.category.name,
                calories: data.nutrition.calories.value,
                protein: data.nutrition.protein.value,
                fat: data.nutrition.fat.value,
                carbs: data.nutrition.carbs.value
            };
            selectFood(foodData);
            document.getElementById('search-results').innerHTML = `–ù–∞–π–¥–µ–Ω–æ: ${foodData.name}!`;
        } else {
            document.getElementById('search-results').innerHTML = '–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å –µ–¥—É –Ω–∞ —Ñ–æ—Ç–æ.';
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:', error);
        document.getElementById('search-results').innerHTML = `–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞: ${error.message}`;
    } finally {
        input.value = '';
    }
}
// –ö–û–ù–ï–¶ –ù–û–í–û–ì–û –ë–õ–û–ö–ê

        function selectFood(data) {
            document.getElementById('manual-name').value = data.name;
            document.getElementById('manual-calories').value = data.calories.toFixed(0);
            document.getElementById('manual-protein').value = data.protein.toFixed(1);
            document.getElementById('manual-fat').value = data.fat.toFixed(1);
            document.getElementById('manual-carbs').value = data.carbs.toFixed(1);
            document.getElementById('search-results').innerHTML = '';
        }
        
        function addFoodEntry() {
            const dateKey = selectedDate.toISOString().split('T')[0];
            const data = loadDataForDate(dateKey);
            if (!data.food) data.food = [];
            
            const newFood = {
                id: 'food_' + Date.now(),
                mealType: currentMealType,
                name: document.getElementById('manual-name').value,
                calories: parseFloat(document.getElementById('manual-calories').value) || 0,
                protein: parseFloat(document.getElementById('manual-protein').value) || 0,
                fat: parseFloat(document.getElementById('manual-fat').value) || 0,
                carbs: parseFloat(document.getElementById('manual-carbs').value) || 0,
            };
            data.food.push(newFood);
            saveDataForDate(dateKey, data);
            renderDiary();
            closeModal();
        }
        
        function removeFood(id) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –∑–∞–ø–∏—Å—å?')) return;
            const dateKey = selectedDate.toISOString().split('T')[0];
            const data = loadDataForDate(dateKey);
            data.food = data.food.filter(f => f.id !== id);
            saveDataForDate(dateKey, data);
            renderDiary();
        }
        
        // --- –î—Ä—É–≥–∏–µ –¥–µ–π—Å—Ç–≤–∏—è ---
        function updateWater(amount) {
            const dateKey = selectedDate.toISOString().split('T')[0];
            const data = loadDataForDate(dateKey);
            data.water = (data.water || 0) + amount;
            if (data.water < 0) data.water = 0;
            saveDataForDate(dateKey, data);
            renderDiary();
        }

        function addWeight() {
            const weight = prompt('–í–≤–µ–¥–∏—Ç–µ –≤–∞—à —Ç–µ–∫—É—â–∏–π –≤–µ—Å –≤ –∫–≥:');
            if (weight && !isNaN(weight)) {
                const dateKey = selectedDate.toISOString().split('T')[0];
                const data = loadDataForDate(dateKey);
                data.weight = parseFloat(weight);
                saveDataForDate(dateKey, data);
                renderDiary();
            }
        }
        
        function addActivity() {
            const calories = prompt('–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–∂–∂–µ–Ω–Ω—ã—Ö –∫–∞–ª–æ—Ä–∏–π:');
            if (calories && !isNaN(calories)) {
                const dateKey = selectedDate.toISOString().split('T')[0];
                const data = loadDataForDate(dateKey);
                data.activity = (data.activity || 0) + parseFloat(calories);
                saveDataForDate(dateKey, data);
                renderDiary();
            }
        }

    </script>
</body>

</html>


